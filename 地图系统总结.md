# 地图系统实现总结

## 核心组件

1. **节点地图场景（node_map_scene）**:
   - 管理整个地图的显示和交互
   - 生成随机地图布局
   - 处理玩家在地图上的进度

2. **地图节点（map_node）**:
   - 表示地图上的各种地点（敌人、商店、休息点等）
   - 管理节点状态（锁定、可用、已访问、当前）
   - 处理玩家交互

3. **地图连接线（map_edge）**:
   - 显示节点之间的连接关系
   - 根据可用性和访问状态改变外观

## 数据结构

1. **节点类型枚举（NodeType）**:
   - START: 起点节点
   - ENEMY: 普通敌人节点
   - ELITE: 精英敌人节点
   - SHOP: 商店节点
   - REST: 休息节点
   - TREASURE: 宝箱节点
   - EVENT: 事件节点
   - BOSS: Boss节点
   - END: 终点节点

2. **节点状态枚举（NodeState）**:
   - LOCKED: 锁定状态，玩家无法访问
   - AVAILABLE: 可用状态，玩家可以访问
   - VISITED: 已访问状态
   - CURRENT: 当前位置

3. **地图状态数据**:
   - current_floor: 当前楼层
   - current_node_id: 当前节点ID
   - nodes_state: 所有节点的状态信息

## 主要功能

1. **地图生成**:
   - 分层生成节点，每层有预定数量的节点
   - 随机决定每个节点的类型
   - 创建节点间的连接关系，确保路径合理性

2. **地图导航**:
   - 玩家只能访问从当前节点可达的节点
   - 访问节点后更新状态，并解锁新的可访问节点
   - 显示路径可用性（高亮或变暗）

3. **节点交互**:
   - 不同节点类型触发不同的游戏内容（战斗、商店、事件等）
   - 完成节点内容后返回地图继续探索
   - 到达Boss节点并击败后完成当前楼层

4. **状态保存**:
   - 保存玩家在地图上的进度
   - 在不同场景（战斗、商店）间切换时保持地图状态
   - 在完成楼层后重置地图状态，进入新楼层

## 集成方式

1. **与游戏管理器的集成**:
   - 在GameManager中添加地图状态保存和获取功能
   - 添加处理地图节点事件的方法
   - 管理楼层进度和玩家数据

2. **与场景管理器的集成**:
   - 添加地图模式入口
   - 处理在地图和其他场景（战斗、商店）之间的切换
   - 管理地图完成和楼层转换

## 使用流程

1. 玩家从主菜单选择"地图模式"
2. 显示地图场景，初始只有起点是当前节点
3. 玩家选择可用节点，触发相应内容（战斗、商店等）
4. 完成节点内容后返回地图，继续探索
5. 到达并击败Boss后，进入下一楼层，重新生成地图
6. 游戏进度存储在GameManager中，允许玩家退出并继续游戏

## 可扩展性考虑

1. **节点类型扩展**:
   - 可以轻松添加新的节点类型，如特殊事件、挑战等
   - 每种节点类型可以有多种变体

2. **地图生成算法改进**:
   - 可以实现不同的地图生成策略（更随机、更线性等）
   - 可以根据游戏进度增加难度

3. **UI优化**:
   - 添加缩放和平移功能
   - 实现小地图或全局视图
   - 添加更多视觉效果提升游戏体验 